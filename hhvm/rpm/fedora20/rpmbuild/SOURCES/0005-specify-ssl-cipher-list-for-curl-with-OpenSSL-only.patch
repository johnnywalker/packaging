From 09d922079412917d30b3388266ec85ef1c413c6d Mon Sep 17 00:00:00 2001
From: Johnny Walker <jwalker@ashley-martin.com>
Date: Mon, 21 Jul 2014 15:53:58 -0600
Subject: [PATCH 5/7] specify ssl cipher list for curl with OpenSSL only

---
 hphp/runtime/base/http-client.cpp | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/hphp/runtime/base/http-client.cpp b/hphp/runtime/base/http-client.cpp
index 630e26b..f4e5aa8 100644
--- a/hphp/runtime/base/http-client.cpp
+++ b/hphp/runtime/base/http-client.cpp
@@ -138,7 +138,13 @@ int HttpClient::request(const char* verb,
   curl_easy_setopt(cp, CURLOPT_NOSIGNAL, 1); // for multithreading mode
   curl_easy_setopt(cp, CURLOPT_SSL_VERIFYPEER,    0);
   curl_easy_setopt(cp, CURLOPT_SSL_CTX_FUNCTION, curl_tls_workarounds_cb);
-  curl_easy_setopt(cp, CURLOPT_SSL_CIPHER_LIST, "ALL");
+
+  /*
+   * cipher list varies according to SSL library, and "ALL" is for OpenSSL
+   */
+  curl_version_info_data *cver = curl_version_info(CURLVERSION_NOW);
+  if (cver && cver->ssl_version && strstr(cver->ssl_version, "OpenSSL"))
+		  curl_easy_setopt(cp, CURLOPT_SSL_CIPHER_LIST, "ALL");
 
   curl_easy_setopt(cp, CURLOPT_TIMEOUT,           m_timeout);
   if (m_maxRedirect > 1) {
-- 
1.9.3

